# Blog í”„ë¡œì íŠ¸ ë¦¬ë·°

24-27 ì¥ì— ê±°ì¹œ í”„ë¡ íŠ¸ì—”ë“œ ë¸”ë¡œê·¸ í”„ë¡œì íŠ¸ì˜ ë¦¬ë·°ë¥¼ ì§„í–‰í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ìµœëŒ€í•œ í”„ë¡ íŠ¸ ë¶€ë¶„ì˜ ëª¨ë“  ì½”ë“œë¥¼ ê¼¼ê¼¼í•˜ê²Œ ë³´ê³  ë„˜ì–´ê°€ëŠ” ê²ƒì´ ëª©í‘œì´ê³ , ì´ë¥¼ í†µí•´ ë¦¬ë•ìŠ¤ ì‚¬ê°€ì— ëŒ€í•œ ì´í•´ì™€, ì „ì²´ì ì¸ í”„ë¡œì íŠ¸ êµ¬ì¡°ë¥¼ ì´í•´í•˜ê²Œ ë˜ëŠ” ê²ƒì´ ëª©í‘œì…ë‹ˆë‹¤.



í˜„ì¬ í”„ë¡œì íŠ¸ì˜ êµ¬ì¡°ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

```
ğŸ“¦src
 â”£ ğŸ“‚components
 â”ƒ â”£ ğŸ“‚auth
 â”ƒ â”ƒ â”£ ğŸ“œAuthForm.js
 â”ƒ â”ƒ â”— ğŸ“œAuthTemplate.js
 â”ƒ â”£ ğŸ“‚base
 â”ƒ â”£ ğŸ“‚common
 â”ƒ â”ƒ â”£ ğŸ“œAskModals.js
 â”ƒ â”ƒ â”£ ğŸ“œButton.js
 â”ƒ â”ƒ â”£ ğŸ“œHeader.js
 â”ƒ â”ƒ â”£ ğŸ“œResponsive.js
 â”ƒ â”ƒ â”£ ğŸ“œSubInfo.js
 â”ƒ â”ƒ â”— ğŸ“œTags.js
 â”ƒ â”£ ğŸ“‚post
 â”ƒ â”ƒ â”£ ğŸ“œAskRemoveModal.js
 â”ƒ â”ƒ â”£ ğŸ“œPostActionButtons.js
 â”ƒ â”ƒ â”— ğŸ“œPostViewer.js
 â”ƒ â”£ ğŸ“‚posts
 â”ƒ â”ƒ â”£ ğŸ“œPagination.js
 â”ƒ â”ƒ â”— ğŸ“œPostList.js
 â”ƒ â”— ğŸ“‚write
 â”ƒ â”ƒ â”£ ğŸ“œEditor.js
 â”ƒ â”ƒ â”£ ğŸ“œTagBox.js
 â”ƒ â”ƒ â”— ğŸ“œWriteActionButtons.js
 â”£ ğŸ“‚containers
 â”ƒ â”£ ğŸ“‚auth
 â”ƒ â”ƒ â”£ ğŸ“œLoginForm.js
 â”ƒ â”ƒ â”— ğŸ“œRegisterForm.js
 â”ƒ â”£ ğŸ“‚common
 â”ƒ â”ƒ â”— ğŸ“œHeaderContainer.js
 â”ƒ â”£ ğŸ“‚post
 â”ƒ â”ƒ â”— ğŸ“œPostViewerContainer.js
 â”ƒ â”£ ğŸ“‚posts
 â”ƒ â”ƒ â”£ ğŸ“œPaginationContainer.js
 â”ƒ â”ƒ â”— ğŸ“œPostListContainer.js
 â”ƒ â”— ğŸ“‚write
 â”ƒ â”ƒ â”£ ğŸ“œEditorContainer.js
 â”ƒ â”ƒ â”£ ğŸ“œTagBoxContainer.js
 â”ƒ â”ƒ â”— ğŸ“œWriteActionButtonsContainer.js
 â”£ ğŸ“‚lib
 â”ƒ â”£ ğŸ“‚api
 â”ƒ â”ƒ â”£ ğŸ“œauth.js
 â”ƒ â”ƒ â”£ ğŸ“œclient.js
 â”ƒ â”ƒ â”— ğŸ“œposts.js
 â”ƒ â”£ ğŸ“‚styles
 â”ƒ â”ƒ â”— ğŸ“œpalette.js
 â”ƒ â”— ğŸ“œcreateRequestSaga.js
 â”£ ğŸ“‚modules
 â”ƒ â”£ ğŸ“œauth.js
 â”ƒ â”£ ğŸ“œindex.js
 â”ƒ â”£ ğŸ“œloading.js
 â”ƒ â”£ ğŸ“œpost.js
 â”ƒ â”£ ğŸ“œposts.js
 â”ƒ â”£ ğŸ“œuser.js
 â”ƒ â”— ğŸ“œwrite.js
 â”£ ğŸ“‚pages
 â”ƒ â”£ ğŸ“œLoginPage.js
 â”ƒ â”£ ğŸ“œPostListPage.js
 â”ƒ â”£ ğŸ“œPostPage.js
 â”ƒ â”£ ğŸ“œRegisterPage.js
 â”ƒ â”— ğŸ“œWritePage.js
 â”£ ğŸ“œApp.css
 â”£ ğŸ“œApp.js
 â”£ ğŸ“œindex.css
 â”£ ğŸ“œindex.js
```



# íšŒì› ì¸ì¦

ì²« ë²ˆì§¸ë¡œ ì‚´í´ë³¼ ë¶€ë¶„ì€ íšŒì› ì¸ì¦ ë¶€ë¶„ì…ë‹ˆë‹¤. íšŒì› ì¸ì¦ê³¼ ê´€ë ¨ëœ ë¶€ë¶„ì€ `src/lib/api/auth`, `src/components/auth/`, `src/containers/auth`, `src/modules/auth.js`, `src/modules/user.js`, `src/pages/LoginPage.js`, `src/pages/RegisterPage.js` ì…ë‹ˆë‹¤. ì¼ë‹¨ API í˜¸ì¶œí•˜ëŠ” ë¶€ë¶„ë¶€í„° ì‚´í´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.



## API ìš”ì²­

API ìš”ì²­ì„ ë³´ë‚´ëŠ” ë¶€ë¶„ë§Œ ì²˜ë¦¬í•©ë‹ˆë‹¤. ì‘ë‹µì— ëŒ€í•œ ë¶€ë¶„ì€ ë³„ë„ ì²˜ë¦¬ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.



### lib/api/client.js

`client.js` íŒŒì¼ì€ ì‹¤ì œë¡œ 3 ì¤„ë¡œ ì‘ì„±ë˜ì—ˆì„ ì •ë„ë¡œ ê°„ë‹¨í•©ë‹ˆë‹¤.  axios ëª¨ë“ˆì„ í˜¸ì¶œí•˜ê³ , ì´ë¥¼ client ì— í• ë‹¹í•˜ê³ , client ë¥¼ export í•˜ëŠ” ì‘ì—…ì´ ì „ë¶€ì…ë‹ˆë‹¤.

```react
import axios from 'axios';

const client = axios.create();

export default client;
```

ì—¬ê¸°ì„œ ì˜ë¬¸ì´ ë“œëŠ” ë¶€ë¶„ì€, ì´ë ‡ê²Œ í•  ê±°ë©´ api ë¥¼ ì‚¬ìš©í•˜ëŠ” íŒŒì¼ì—ì„œ axios ë¥¼ í˜¸ì¶œí•´ì„œ ì‚¬ìš©í•˜ë©´ ë˜ëŠ” ê²ƒ ì•„ë‹Œê°€? ì…ë‹ˆë‹¤. ì§€ê¸ˆ `client.js` íŒŒì¼ì´ í•˜ëŠ” ì¼ì´ axios ë¡œ ë§Œë“  ê°ì²´ë¥¼ ë°˜í™˜í•˜ëŠ” ê²ƒ ë°–ì— í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— êµ³ì´ ë§Œë“¤ì§€ ì•Šê³  ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë” ì¢‹ì€ ë°©ë²•ì´ ë  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

ì´ íŒŒì¼ì„ ë§Œë“  ì´ìœ ëŠ” ì „ì—­ ì„¤ì • ë•Œë¬¸ì…ë‹ˆë‹¤. ì„œë²„ api ì£¼ì†Œê°€ ë³€ê²½ë˜ì–´ baseURL ì„ ë°”ê¾¸ì–´ì•¼ í•œë‹¤ë˜ê°€, í—¤ë” ì„¤ì •ì„ ì¼ê´„ì ìœ¼ë¡œ ì ìš©í•´ì•¼ í•˜ëŠ” ë¶€ë¶„ì´ ìƒê²¼ì„ ë•Œ ë§Œì•½ api ë¥¼ ì‚¬ìš©í•˜ëŠ” ëª¨ë“  íŒŒì¼ì—ì„œ axios ë¥¼ ê°€ì ¸ì™€ ì‚¬ìš©í–ˆë‹¤ë©´, ì „ì²´ íŒŒì¼ì„ ëª¨ë‘ ìˆ˜ì •í•´ì•¼ í•˜ëŠ” ìƒí™©ì´ ë°œìƒí•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ìœ„ ì²˜ëŸ¼ client ë¥¼ ë”°ë¡œ ë–¼ì–´ë‚´ì„œ api ë¥¼ ì‚¬ìš©í•  ë•Œ, client ë¥¼ ê°€ì ¸ì™€ ì‚¬ìš©í–ˆë‹¤ë©´, `client.js` íŒŒì¼ë§Œ ìˆ˜ì •í•´ë„ ì „ì—­ì ìœ¼ë¡œ ì ìš©ë©ë‹ˆë‹¤.



### lib/api/auth.js

`auth.js` íŒŒì¼ì€ ì„œë²„ì— api ìš”ì²­ì„ ë³´ë‚´ëŠ” ë¶€ë¶„ì„ ì‘ì„±í–ˆìŠµë‹ˆë‹¤. ì½”ë“œë„ ì‹¤ì œ api ìš”ì²­ì„ ì „ì†¡í•˜ëŠ” ê²ƒ ê¹Œì§€ë§Œ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.

```react
import client from './client';

export const login = ({ username, password }) => client.post('/api/auth/login', { username, password });

export const register = ({ username, password }) => client.post('/api/auth/register', { username, password });

export const check = () => client.get('/api/auth/check');

export const logout = () => client.post('/api/auth/logout');
```

ì´ì „ì— ë§Œë“  client ë¥¼ ê°€ì ¸ì™€ api ìš”ì²­ì„ í–ˆê³ , ë¡œê·¸ì¸, íšŒì›ê°€ì…, ë¡œê·¸ì¸ ì²´í¬, ë¡œê·¸ì•„ì›ƒì— ëŒ€í•œ api ìš”ì²­ì„ ì „ì†¡í•˜ëŠ” í•¨ìˆ˜ë“¤ë¡œ êµ¬í˜„ë˜ì–´ ìˆìŠµë‹ˆë‹¤.



## ìƒíƒœ ê´€ë¦¬

ìƒíƒœ ê´€ë¦¬ë¥¼ ì•Œì•„ë³´ê¸°ì— ì•ì„œ, ë¦¬ë•ìŠ¤ ì‚¬ê°€ í•¨ìˆ˜ë¥¼ ìƒì„±í•˜ëŠ” ìœ í‹¸ íŒŒì¼ì„ ë¨¼ì € ì‚´í´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.



### lib/createRequestSaga.js

`createRequestSaga.js` íŒŒì¼ì—ëŠ” **createRequestActionTypes** ì™€ **createReuqestSaga** ë‘ ê°œì˜ í•¨ìˆ˜ê°€ ìˆìŠµë‹ˆë‹¤. 

#### createRequestActionTypes

createRequestActionTypes ëŠ” ë¦¬ë•ìŠ¤ ì•¡ì…˜ íƒ€ì…ì„ ìƒì„±í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤. ë°˜í™˜í•˜ëŠ” ì•¡ì…˜ì˜ ì¢…ë¥˜ëŠ” 3ê°€ì§€ ì…ë‹ˆë‹¤.

* [ì´ë¦„]
* [ì´ë¦„]_SUCCESS
* [ì´ë¦„]_FAILURE



ì´ ì„¸ ê°€ì§€ ì•¡ì…˜ íƒ€ì…ì„ ìƒì„± í•˜ê¸° ìœ„í•´ [ì´ë¦„] ì„ ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ì•„ì•¼ í•©ë‹ˆë‹¤.

```react
export const createRequestActionTypes = (type) => {
  const SUCCESS = `${type}_SUCCESS`;
  const FAILURE = `${type}_FAILURE`;
  return [type, SUCCESS, FAILURE];
};
```

ì½”ë“œì—ì„œ type ì— ì´ë¦„ì´ ë“¤ì–´ì˜µë‹ˆë‹¤. ì‹¤ì œë¡œ `user/LOGIN` ê³¼ ê°™ì€ í˜•íƒœê°€ ë“¤ì–´ì™€ì•¼ í•©ë‹ˆë‹¤.



#### createRequestSaga

ë¦¬ë•ìŠ¤ ì‚¬ê°€ í•¨ìˆ˜ë¥¼ ìƒì„±í•˜ëŠ” í•µì‹¬ ë¶€ë¶„ì…ë‹ˆë‹¤. ìœ„ì˜ ì•¡ì…˜ íƒ€ì…ì„ ìƒì„±í•˜ëŠ” í•¨ìˆ˜ì²˜ëŸ¼ ì•¡ì…˜ íƒ€ì… ì´ë¦„ì„ ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ê³ , ì¶”ê°€ë¡œ ì‚¬ìš©í•  api ìš”ì²­ì„ ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ìŠµë‹ˆë‹¤. api í˜¸ì¶œì˜ ê²°ê³¼ë¥¼ SUCCESS, FAILURE ë‘ ê²½ìš°ë¡œ ë‚˜ëˆ„ê³ , ì œë„ˆë ˆì´íŠ¸ í•¨ìˆ˜ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.



```react
export default function createRequestSaga(type, request) {
  const SUCCESS = `${type}_SUCCESS`;
  const FAILURE = `${type}_FAILURE`;

  return function* (action) {
    yield put(startLoading(type));
    try {
      const response = yield call(request, action.payload);
      yield put({
        type: SUCCESS,
        payload: response.data,
        meta: response,
      });
    } catch (e) {
      yield put({
        type: FAILURE,
        payload: e,
        error: true,
      });
    }
    yield put(finishLoading(type));
  };
}
```

action ì€ ë””ìŠ¤íŒ¨ì¹˜ì— ì‚¬ìš©í•˜ëŠ” ì‹¤ì œ ì•¡ì…˜ì…ë‹ˆë‹¤. `createRequestSaga`  ë¥¼ í†µí•´ ìƒì„±ëœ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ì•¡ì…˜ì„ íŒŒë¼ë¯¸í„°ë¡œ ë„£ì–´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤. ë§Œì•½ payload ë¶€ë¶„ ì—†ì´ ë””ìŠ¤íŒ¨ì¹˜ê°€ ê°€ëŠ¥í•œ ê²½ìš°, ì•¡ì…˜ íŒŒë¼ë¯¸í„°ë¥¼ ë„£ì–´ì£¼ì§€ ì•Šì•„ë„ ë¬´ë°©í•©ë‹ˆë‹¤.

try - catch êµ¬ë¬¸ì„ ì‚¬ìš©í•´ ì„±ê³µ ì‹¤íŒ¨ë¥¼ ë‚˜ëˆ„ì–´ ì²˜ë¦¬í•©ë‹ˆë‹¤. ì„±ê³µ ë¶€ë¶„ì„ ë¨¼ì € ì‚´í´ë³´ë©´, ë¦¬ë•ìŠ¤ ì‚¬ê°€ì˜ call ì´í™íŠ¸ë¥¼ ì‚¬ìš©í•´ api ë¹„ë™ê¸° í˜¸ì¶œ ê²°ê³¼ë¥¼ ë°›ì•„ì˜µë‹ˆë‹¤. ì´í›„ put ì´í™íŠ¸ë¥¼ ì‚¬ìš©í•´ ì„±ê³µ ê²°ê³¼ë¥¼ ë””ìŠ¤íŒ¨ì¹˜í•©ë‹ˆë‹¤.

try êµ¬ë¬¸ ë‚´ì—ì„œ ì—ëŸ¬ê°€ ë°œìƒí•  ê²½ìš° catch êµ¬ë¬¸ìœ¼ë¡œ ë‚´ë ¤ì˜µë‹ˆë‹¤. ì—¬ê¸°ì„œ api í˜¸ì¶œ ì‹¤íŒ¨ì— ëŒ€í•œ ë‚´ìš©ì„ ë””ìŠ¤íŒ¨ì¹˜í•©ë‹ˆë‹¤.

í•¨ìˆ˜ì˜ ì‹œì‘ê³¼ ëì—ì„œ ë‚˜íƒ€ë‚˜ëŠ” `startLoading` ê³¼ `finishLoading` ì€ ë°”ë¡œ ì•„ë˜ì—ì„œ ì‚´í´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.



### modules/loading.js

ë¡œë”© ë¦¬ë“€ì„œëŠ” ë¸”ë¡œê·¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ëª¨ë“  api í˜¸ì¶œì— ëŒ€í•œ ë¡œë”© ìƒíƒœë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ì•¡ì…˜ í˜ì´ë¡œë“œì— ë¡œë”© ìƒíƒœë¥¼ ë°”ê¾¸ë ¤ëŠ” ëŒ€ìƒì„ ê¼­ ë„£ì–´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.

```react
import { createAction, handleActions } from 'redux-actions';

const START_LOADING = 'loading/START_LOADING';
const FINISH_LOADING = 'loading/FINISH_LOADING';

export const startLoading = createAction(START_LOADING, (requestType) => requestType);
export const finishLoading = createAction(FINISH_LOADING, (requestType) => requestType);

const initialState = {};

const loading = handleActions(
  {
    [START_LOADING]: (state, action) => ({
      ...state,
      [action.payload]: true,
    }),
    [FINISH_LOADING]: (state, action) => ({
      ...state,
      [action.payload]: false,
    }),
  },
  initialState,
);

export default loading;
```

loading ë¦¬ë“€ì„œëŠ” ë‹¤ë¥¸ ì–´ë–¤ ìƒíƒœê°€ ì¡´ì¬í•˜ëŠ”ì§€ ëª¨ë¥´ê¸° ë•Œë¬¸ì— ì´ˆê¸° ìƒíƒœê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤. ë¡œë”©ì˜ ìƒíƒœë¥¼ ë³€í™”ì‹œí‚¤ëŠ” ì•¡ì…˜ì€ ì•„ë˜ì™€ ê°™ì€ í˜•íƒœë¥¼ ê°€ì ¸ì•¼ í•©ë‹ˆë‹¤.

```javascript
{
  type: START_LOADING,
  payload: 'user/LOGIN'
}
```

ë§Œì•½ ì‹¤ì œ ìœ„ì˜ ì•¡ì…˜ì´ ë””ìŠ¤íŒ¨ì¹˜ ë˜ë©´, ìƒíƒœëŠ” ì•„ë˜ì™€ ê°™ì´ ë³€ê²½ë©ë‹ˆë‹¤.

```javascript
{
  user/LOGIN: true
}
```



ë¡œë”©ì´ ëë‚¬ì„ ê²½ìš°, ìœ„ì˜ ì•¡ì…˜ì—ì„œ type ë¶€ë¶„ë§Œ FINISH_LOADING ìœ¼ë¡œ ë°”ê¾¸ë©´ `user/LOGIN` ì˜ ìƒíƒœê°€ false ë¡œ ë³€ê²½ë©ë‹ˆë‹¤.



### modules/auth.js

`auth.js` ì—ì„œëŠ” ë¡œê·¸ì¸, íšŒì›ê°€ì…ì— ëŒ€í•œ ìƒíƒœë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤. ë˜í•œ, ë¡œê·¸ì¸ê³¼ íšŒì›ê°€ì… ì‹œ í¼ì„ ì…ë ¥í•´ì•¼ í•˜ê³ , ì´ í¼ì— ëŒ€í•œ ê´€ë¦¬ë„ auth ë¦¬ë•ìŠ¤ì—ì„œ ê´€ë¦¬í•©ë‹ˆë‹¤.

ì¼ë‹¨ ì–´ë–¤ ëª¨ë“ˆì„ ê°€ì ¸ì˜¤ëŠ”ì§€ ì„¤ëª…í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

```react
import { createAction, handleActions } from 'redux-actions';
import produce from 'immer';
import { takeLatest } from '@redux-saga/core/effects';
import createRequestSaga, { createRequestActionTypes } from '../lib/createRequestSaga';
import * as authAPI from '../lib/api/auth';
```

ì•¡ì…˜ì„ ë§Œë“¤ê³ , ë¦¬ë“€ì„œì—ì„œ í•´ë‹¹ ì•¡ì…˜ì— ëŒ€í•œ ì²˜ë¦¬ë¥¼ í•˜ê¸° ìœ„í•œ `createAction` ê³¼ `handleActions` ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤. ë˜í•œ `immer` ë¥¼ ì‚¬ìš©í•´ ìƒíƒœì˜ ë¶ˆë³€ì„±ì„ ìœ ì§€í•©ë‹ˆë‹¤.

`takeLatest` ë¦¬ë•ìŠ¤ ì‚¬ê°€ë¥¼ ì‚¬ìš©í•˜ì—¬, ë§ˆì§€ë§‰ api ìš”ì²­ì— ëŒ€í•œ ì²˜ë¦¬ë§Œ ì§„í–‰í•˜ë„ë¡ ì²˜ë¦¬í•©ë‹ˆë‹¤.

`createRequestSaga` ì™€ `createRequestActionTypes` ëŠ” ìœ„ì˜ ìœ í‹¸ í•¨ìˆ˜ì—ì„œ ì„ ì–¸í•œ ë°”ì™€ ê°™ì´ ë¦¬ë•ìŠ¤ ì‚¬ê°€ í•¨ìˆ˜ì™€ ì•¡ì…˜ íƒ€ì…ì„ ìƒì„±í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.

`lib/api/auth.js` íŒŒì¼ì— export default ë¡œ ìµìŠ¤í¬íŠ¸ í•˜ì§€ ì•Šê³ , ëª¨ë‘ export cosntë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. ì´ë¥¼ `authAPI` ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ê°€ì ¸ì™€ì„œ `authAPI.login` í˜•íƒœë¡œ ì‚¬ìš©í•˜ê²Œ í•©ë‹ˆë‹¤.



#### ë¡œê·¸ì¸

ë¡œê·¸ì¸ ë¶€ë¶„ì„ ë¨¼ì € ì„¤ëª…í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ ì—­ì‹œ api í˜¸ì¶œì„ í•´ì•¼í•˜ê¸° ë•Œë¬¸ì—, í˜¸ì¶œ, ì„±ê³µ, ì‹¤íŒ¨ ì„¸ ê°€ì§€ë¡œ ë‚˜ë‰©ë‹ˆë‹¤. ì„¸ ê°€ì§€ ì•¡ì…˜ íƒ€ì…ì„ `createRequestActionTypes` ë¥¼ ì‚¬ìš©í•´ ìƒì„±í•©ë‹ˆë‹¤.

```react
const [LOGIN, LOGIN_SUCCESS, LOGIN_FAILURE] = createRequestActionTypes('auth/LOGIN');
```

ê²°ê³¼ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

* LOGIN: auth/LOGIN
* LOGIN_SUCCESS: auth/LOGIN_SUCCESS
* LOGIN_FAILURE: auth/LOGIN_FAILURE



ì•¡ì…˜ íƒ€ì…ì„ ìƒì„±í–ˆìœ¼ë©´, ë‹¤ìŒìœ¼ë¡œ ì•¡ì…˜ ê°ì²´ë¥¼ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤. `createAction` ì„ ì‚¬ìš©í•´ ë¡œê·¸ì¸ ì•¡ì…˜ì„ ìƒì„±í•©ë‹ˆë‹¤.

```react
export const login = createAction(LOGIN, ({ username, password }) => ({ username, password }));
```

login í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ê°ì²´ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

```javascript
{
  type: 'user/LOGIN',
  payload: {
      username: 'ìœ ì €ì´ë¦„',
      password: 'ë¹„ë°€ë²ˆí˜¸'
  }
}
```



ì´ì œ ë¡œê·¸ì¸ ë¹„ë™ê¸° í˜¸ì¶œì„ ì²˜ë¦¬í•˜ëŠ” ë¦¬ë•ìŠ¤ ì‚¬ê°€ í•¨ìˆ˜ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ì´ ë•Œ, ì´ì „ì— ë§Œë“¤ì–´ ë†“ì€ `createRequestSaga` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒì„±í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

```react
const loginSaga = createRequestSaga(LOGIN, authAPI.login);
```

createRequestSaga ëŠ” ì•¡ì…˜ íƒ€ì…ê³¼ API í˜¸ì¶œ ìš”ì²­ì„ ë§¤ê°œ ë³€ìˆ˜ë¡œ ë°›ìŠµë‹ˆë‹¤. ì´ì œ loginSaga ëŠ” ì•„ë˜ í•¨ìˆ˜ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.

```react
function* loginSaga(action) {
  yield put(startLoading('user/LOGIN'));
  try {
      const response = yield call(authAPI.login, action.payload);
      yield put({
          type: 'user/LOGIN_SUCCESS',
          payload: response.data,
          meta: response
      });
  } catch (e) {
      yield put({
          type: 'user/LOGIN_FAILURE',
          payload: e,
          error: true
      })
  }
}
```

ë¦¬ë•ìŠ¤ ì‚¬ê°€ì˜ call ì´í™íŠ¸ë¥¼ ì‚¬ìš©í•´ì„œ, api í˜¸ì¶œ ê²°ê³¼ë¥¼ response ì— ë‹´ê³ , ì„±ê³µí•  ê²½ìš°, ì„±ê³µ íƒ€ì…ì˜ ì•¡ì…˜ì„ ë””ìŠ¤íŒ¨ì¹˜í•˜ê³ , ì—ëŸ¬ ë°œìƒì‹œ, ì‹¤íŒ¨ íƒ€ì…ì˜ ì•¡ì…˜ì„ ë””ìŠ¤íŒ¨ì¹˜í•©ë‹ˆë‹¤.



ì´ì œ `takeLatest` ì´í™íŠ¸ë¥¼ ì‚¬ìš©í•´ `LOGIN` ì•¡ì…˜ì´ ë“¤ì–´ì˜¬ ë•Œ, `loginSaga` í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ë„ë¡ í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.

```react
export function* authSaga() {
  yield takeLatest(LOGIN, loginSaga);
}
```

`authSaga` ë¥¼ ë£¨íŠ¸ ì‚¬ê°€ì— ë“±ë¡í•˜ë©´, LOGIN íƒ€ì… ì•¡ì…˜ì´ ë“¤ì–´ì˜¬ ë•Œ, loginSaga í•¨ìˆ˜ê°€ ì‹¤í–‰ë©ë‹ˆë‹¤.



auth ë¦¬ë“€ì„œì˜ ì´ˆê¸° ìƒíƒœëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

```javascript
const initialState = {
  register: {
    username: '',
    password: '',
    passwordConfirm: '',
  },
  login: {
    username: '',
    password: '',
  },
  auth: null,
  authError: null,
};
```

ë¡œê·¸ì¸ì—ì„œ ë‹¤ë£° ë¶€ë¶„ì€ authì™€ authError ë¶€ë¶„ì…ë‹ˆë‹¤. ë‹¹ì—°íˆ ë‹¤ë£° ê²ƒ ê°™ì€ login ë¶€ë¶„ì€ inputì„ ë‹¤ë£° ë•Œ ì‚¬ìš©í•˜ê²Œ ë©ë‹ˆë‹¤.



ë¡œê·¸ì¸ì˜ ë§ˆì§€ë§‰ ë¶€ë¶„ì¸ ë¦¬ë“€ì„œì…ë‹ˆë‹¤. ë¦¬ë“€ì„œëŠ” LOGIN_SUCCESS ì™€ LOGIN_FAILURE ì•¡ì…˜ì„ ë°›ì•˜ì„ ë•Œ, authì™€ authErrorì˜ ìƒíƒœë¥¼ ë³€í™”ì‹œí‚µë‹ˆë‹¤.

```react
const auth = handleActions({
    // ...
  [LOGIN_SUCCESS]: (state, {payload: auth}) => ({...state, authError: null, auth}),
  [LOGIN_FAILURE]: (state, {payload: authError}) => ({...state, auth: null, authError})
}, initialState);
```



#### íšŒì›ê°€ì…

íšŒì›ê°€ì… ì—­ì‹œ ë¡œê·¸ì¸ê³¼ ë¹„ìŠ·í•˜ê²Œ ì§„í–‰ë©ë‹ˆë‹¤. íšŒì›ê°€ì…ì˜ ì•¡ì…˜ íƒ€ì… ì—­ì‹œ `createRequestActionTypes` ë¥¼ ì‚¬ìš©í•´ ìƒì„±í•©ë‹ˆë‹¤.

```react
const [REGISTER, REGISTER_SUCCESS, REGISTER_FAILURE] = createRequestActionTypes('auth/REGISTER');
```



ì´í›„ `createAction` ì„ ì‚¬ìš©í•´ ì•¡ì…˜ì„ ìƒì„±í•©ë‹ˆë‹¤.

```react
export const register = createAction(REGISTER, ({ username, password }) => ({ username, password }));
```

ë¡œê·¸ì¸ê³¼ ë˜‘ê°™ì´ username ê³¼ password ë¥¼ payload ì— ë„£ê³ , ì´í›„ api í˜¸ì¶œì„ í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.



ì´ì œ ì‹¤ì§ˆì ì¸ ë¹„ë™ê¸° í†µì‹ ì„ í•˜ëŠ” registerSagaë¥¼ `createRequestSaga` ë¥¼ ì‚¬ìš©í•´ ìƒì„±í•˜ê³ , authSaga ì— ì¶”ê°€í•©ë‹ˆë‹¤.

```react
const registerSaga = createRequestSaga(REGISTER, authAPI.register);

export const function* authSaga() {
  takeLatest(REGISTER, registerSaga);
  takeLatest(LOGIN, loginSaga);
}
```



ë¦¬ë“€ì„œì—ì„œ REGISTER_SUCCESS ì™€ REGISTER_FAILURE ì•¡ì…˜ì´ ë””ìŠ¤íŒ¨ì¹˜ ë˜ì—ˆì„ ë•Œ, ìƒíƒœë¥¼ ì–´ë–»ê²Œ ë³€í™”ì‹œí‚¬ì§€ ì½”ë“œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤. 

```react
const auth = handleActions(
  {
    // ...
    [REGISTER_SUCCESS]: (state, { payload: auth }) => ({ ...state, authError: null, auth }),
    [REGISTER_FAILURE]: (state, { payload: error }) => ({ ...state, authError: error }),
    [LOGIN_SUCCESS]: (state, { payload: auth }) => ({ ...state, authError: null, auth }),
    [LOGIN_FAILURE]: (state, { payload: error }) => ({ ...state, authError: error }),
  },
  initialState,
);
```

íšŒì› ê°€ì…ì— ì„±ê³µí•˜ë©´, ë¡œê·¸ì¸ì„ í•œ ê²ƒìœ¼ë¡œ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ë¡œê·¸ì¸ê³¼ ê°™ì€ ìƒíƒœ ë³€í™”ë¥¼ ì¼ìœ¼í‚µë‹ˆë‹¤.



#### í¼ ìƒíƒœ

auth ë¦¬ë•ìŠ¤ì—ì„œ ë¡œê·¸ì¸ í¼ê³¼ íšŒì› ê°€ì… í¼ì„ ë™ì‹œì— ë‹¤ë£¹ë‹ˆë‹¤. ë¡œê·¸ì¸ì€ username ê³¼ password ë‘ ê°œì˜ ì…ë ¥ì„ ë°›ê³ , íšŒì› ê°€ì…ì€ username, password, passwordConfirm ì„¸ ê°œì˜ ì…ë ¥ì„ ë°›ìŠµë‹ˆë‹¤.

í¼ ì…ë ¥ì„ ë‹¤ë£¨ê¸° ìœ„í•œ ì•¡ì…˜ íƒ€ì…ì€ `CHANGE_FIELD` ì™€ `INITIALIZE_FORM` ë‘ ê°œì…ë‹ˆë‹¤.

```react
const CHANGE_FIELD = 'auth/CHANGE_FIELD';
const INITIALIZE_FORM = 'auth/INITIALIZE_FORM';
```



ì´ë²ˆì—ë„ `createAction` ì„ ì‚¬ìš©í•´ì„œ ì•¡ì…˜ì„ ë§Œë“¤ê² ìŠµë‹ˆë‹¤.

```react
export const changeField = createAction(CHANGE_FIELD, ({ form, key, value }) => ({ form, key, value }));
export const initializeForm = createAction(INITIALIZE_FORM, ({form}) => ({form}));
```



ìœ„ì˜ `createAction` ìœ¼ë¡œ ìƒì„±ëœ ì•¡ì…˜ ê°ì²´ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

```javascript
// type: CHANGE_FIELD
{
  type: CHANGE_FIELD,
  payload: {
      form: 'login',
      key: 'username',
      value: 'chamy'
  }
}

// type: INITIALIZE_FORM
{
  type: INITIALIZE_FORM,
  payload: {
      form: 'login'
  }
}
```

payload ë‚´ë¶€ì˜ ê°’ë“¤ì€ ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ëŠ” ê°’ì— ë”°ë¼ ë³€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í˜„ì¬ëŠ” form ì˜ ê²½ìš° login ê³¼ register ë‘˜ ì¤‘ í•˜ë‚˜ë¥¼ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.



ì´ì œ ë¦¬ë“€ì„œì—ì„œ ìœ„ì˜ ì•¡ì…˜ì´ ë“¤ì–´ì™”ì„ ë•Œ, ìƒíƒœë¥¼ ë³€í™”ì‹œí‚¤ëŠ” ë¶€ë¶„ì…ë‹ˆë‹¤.

```react
const auth = handleActions(
  {
    [CHANGE_FIELD]: (state, { payload: { form, key, value } }) =>
      produce(state, (draft) => {
        draft[form][key] = value;
      }),
    [INITIALIZE_FORM]: (state, { payload: form }) => ({ ...state, [form]: initializeForm(form) }),
    [REGISTER_SUCCESS]: (state, { payload: auth }) => ({ ...state, authError: null, auth }),
    [REGISTER_FAILURE]: (state, { payload: error }) => ({ ...state, authError: error }),
    [LOGIN_SUCCESS]: (state, { payload: auth }) => ({ ...state, authError: null, auth }),
    [LOGIN_FAILURE]: (state, { payload: error }) => ({ ...state, authError: error }),
  },
  initialState,
);
```

CHANGE_FIELD ì˜ ê²½ìš°, immer ë¥¼ ì‚¬ìš©í•´ì„œ ë¶ˆë³€ì„±ì„ ê´€ë¦¬í–ˆìŠµë‹ˆë‹¤. 3ë‹¨ êµ¬ì¡°ë¡œ ë˜ì–´ ìˆê¸° ë•Œë¬¸ì—, ë¹„êµ¬ì¡°í™” í• ë‹¹ì„ ì‚¬ìš©í•´ë„ ë˜ì§€ë§Œ, immer ë¥¼ ì‚¬ìš©í•˜ë©´ ì¡°ê¸ˆ ë” ì‰½ê²Œ ë¶ˆë³€ì„±ì„ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. CHANGE_FIELD ì•¡ì…˜ìœ¼ë¡œ `state.login.username`, `state.login.password`, `state.register.username`, `state.register.password`, `state.register.passwordConfirm` ì˜ ìƒíƒœë¥¼ ë³€í™”ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

INITIALIZE_FORM ì€ `state.login` ë˜ëŠ” `state.register` ì˜ ê°’ì„ ì´ˆê¸° ìƒíƒœë¡œ ë³€ê²½ì‹œí‚µë‹ˆë‹¤.



#### ì „ì²´ ì½”ë“œ

`auth.js` ì˜ ì „ì²´ ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

```react
import { createAction, handleActions } from 'redux-actions';
import produce from 'immer';
import { takeLatest } from '@redux-saga/core/effects';
import createRequestSaga, { createRequestActionTypes } from '../lib/createRequestSaga';
import * as authAPI from '../lib/api/auth';

const CHANGE_FIELD = 'auth/CHANGE_FIELD';
const INITIALIZE_FORM = 'auth/INITIALIZE_FORM';

const [REGISTER, REGISTER_SUCCESS, REGISTER_FAILURE] = createRequestActionTypes('auth/REGISTER');
const [LOGIN, LOGIN_SUCCESS, LOGIN_FAILURE] = createRequestActionTypes('auth/LOGIN');

export const changeField = createAction(CHANGE_FIELD, ({ form, key, value }) => ({ form, key, value }));
export const initializeForm = createAction(INITIALIZE_FORM, (form) => form);
export const register = createAction(REGISTER, ({ username, password }) => ({ username, password }));
export const login = createAction(LOGIN, ({ username, password }) => ({ username, password }));

export function* authSaga() {
  yield takeLatest(REGISTER, registerSaga);
  yield takeLatest(LOGIN, loginSaga);
}

const registerSaga = createRequestSaga(REGISTER, authAPI.register);
const loginSaga = createRequestSaga(LOGIN, authAPI.login);

const initialState = {
  register: {
    username: '',
    password: '',
    passwordConfirm: '',
  },
  login: {
    username: '',
    password: '',
  },
  auth: null,
  authError: null,
};

const auth = handleActions(
  {
    [CHANGE_FIELD]: (state, { payload: { form, key, value } }) =>
      produce(state, (draft) => {
        draft[form][key] = value;
      }),
    [INITIALIZE_FORM]: (state, { payload: form }) => ({ ...state, [form]: initializeForm(form) }),
    [REGISTER_SUCCESS]: (state, { payload: auth }) => ({ ...state, authError: null, auth }),
    [REGISTER_FAILURE]: (state, { payload: error }) => ({ ...state, authError: error }),
    [LOGIN_SUCCESS]: (state, { payload: auth }) => ({ ...state, authError: null, auth }),
    [LOGIN_FAILURE]: (state, { payload: error }) => ({ ...state, authError: error }),
  },
  initialState,
);

export default auth;
```



### modules/user.js

íšŒì› ì¸ì¦ì—ì„œ user ë¦¬ë“€ì„œë¥¼ ì¶”ê°€ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤. user ë¦¬ë“€ì„œëŠ” ì‚¬ìš©ìì˜ ë¡œê·¸ì¸ ì—¬ë¶€ì™€ ë¡œê·¸ì•„ì›ƒ ìƒíƒœë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.

ìƒˆë¡œê³ ì¹¨ í–ˆì„ ê²½ìš°, ë¡œê·¸ì¸ ì‚¬ìš©ìì˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë¶€ë¶„ ë¶€í„° ì‹œì‘í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.



#### ìƒˆë¡œê³ ì¹¨ ì‹œ ìœ ì € ì •ë³´

ìƒˆë¡œê³ ì¹¨ í–ˆì„ ê²½ìš° ë¦¬ë•ìŠ¤ëŠ” ì´ˆê¸°í™”ë©ë‹ˆë‹¤. ë”°ë¼ì„œ ê¸°ì¡´ ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì ¸ì™€ì„œ, í˜„ì¬ ìƒíƒœì— ë‹¤ì‹œ ë„£ëŠ” ë¶€ë¶„ì„ ì„¤ëª…í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

ì•¡ì…˜ íƒ€ì…ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

```react
const TEMP_SET_USER = 'user/TEMP_SET_USER';
```



ì´ì œ `createAction` ì„ ì‚¬ìš©í•´ ì•¡ì…˜ì„ ìƒì„±í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

```react
export const tempSetUser = createAction(TEMP_SET_USER, (user) => user);
```

tempSetUser ì•¡ì…˜ ìƒì„± í•¨ìˆ˜ëŠ” ìœ ì € ì •ë³´ë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ì•„ payload ì— ë‹´ìŠµë‹ˆë‹¤.



ìš°ë¦¬ê°€ ë§Œë“œë ¤ëŠ” ìœ ì € ë¦¬ë“€ì„œì˜ ì´ˆê¸° ìƒíƒœëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

```react
const initialState = {
  user: null,
  checkError: null,
};
```

`user` ì—ëŠ” í˜„ì¬ ë¡œê·¸ì¸ ì‚¬ìš©ì ì •ë³´ê°€ ë“¤ì–´ê°€ê³ , `checkError` ì—ëŠ” ì„œë²„ì— ë¡œê·¸ì¸ í™•ì¸ ìš”ì²­ì„ ë³´ëƒˆì„ ë•Œ, ì—ëŸ¬ê°€ ë°œìƒí•œ ê²½ìš° ì—ëŸ¬ ì •ë³´ê°€ ë“¤ì–´ê°‘ë‹ˆë‹¤.



ë§ˆì§€ë§‰ìœ¼ë¡œ `TEMP_SET_USER` íƒ€ì…ì˜ ì•¡ì…˜ì´ ë””ìŠ¤íŒ¨ì¹˜ ëì„ ë•Œ ìƒíƒœë¥¼ ì–´ë–»ê²Œ ë°”ê¿€ì§€ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤. 

```react
export default handleActions({
  [TEMP_SET_USER]: (state, ({payload: user}) => ({...state, user}))
}, initialState);
```

payload ë¡œ ë°›ì€ user ì •ë³´ë¥¼ ìƒíƒœì˜ user ì— ë„£ìŠµë‹ˆë‹¤.



#### ë¡œê·¸ì¸ ì²´í¬

ë¡œê·¸ì¸ ì²´í¬ëŠ” ì´ì „ì˜ ë¡œê·¸ì¸, íšŒì›ê°€ì…ê³¼ ê°™ì´ ìš”ì²­, ì„±ê³µ, ì‹¤íŒ¨ 3ê°œë¡œ ë‚˜ëˆ  ì²˜ë¦¬í•©ë‹ˆë‹¤. ì¼ë‹¨ `createRequestActionTypes` ë¥¼ ì‚¬ìš©í•´ì„œ 3 ê°œì˜ ì•¡ì…˜ íƒ€ì…ì„ ìƒì„±í•©ë‹ˆë‹¤.

```react
const [CHECK, CHECK_SUCCESS, CHECK_FAILURE] = createRequestActionTypes('/user/CHECK');
```



ê¸°ì¡´ì—ëŠ” í•˜ë‚˜ì˜ ë¦¬ë•ìŠ¤ ì‚¬ê°€ í•¨ìˆ˜ë¥¼ ìƒì„±í–ˆì§€ë§Œ, ì´ë²ˆì—ëŠ” ì‹¤íŒ¨í–ˆì„ ë•Œ, localStorage ì—ì„œ ì‚¬ìš©ì ì •ë³´ë¥¼ ì§€ìš°ëŠ” ì‘ì—…ì„ í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì—, ë‘ ê²½ìš°ì˜ ë¦¬ë•ìŠ¤ ì‚¬ê°€ í•¨ìˆ˜ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

```react
// ì„±ê³µ
const checkSaga = createRequestSaga(CHECK, authAPI.check);

// ì‹¤íŒ¨
function checkFailureSaga() {
  try {
      localStorage.removeItem('user');
  } catch (e) {
      console.log ('localStorage is not working');
  }
}

export function* userSaga() {
    yield takeLatest(CHECK, checkSaga);
    yield takeLatest(CHECK_FAILURE, checkFailureSaga);
}
```

`checkFailureSaga` ê°€ ì œë„ˆë ˆì´í„° í•¨ìˆ˜ê°€ ì•„ë‹Œ ê²ƒì´ ì˜¤íƒ€ê°€ ì•„ë‹™ë‹ˆë‹¤. ì—¬ê¸°ì„œ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ í•  í•„ìš”ê°€ ì—†ê¸° ë•Œë¬¸ì— ì¼ë°˜ í•¨ìˆ˜ë¡œ ìƒì„±í•˜ì˜€ê³ , ì¼ë°˜ í•¨ìˆ˜ë„ `takeLatest` ë‚´ì—ì„œ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤.



ì´ì œ ë¦¬ë“€ì„œì—ì„œ ì„±ê³µê³¼ ì‹¤íŒ¨ ì•¡ì…˜ì´ ë””ìŠ¤íŒ¨ì¹˜ ëì„ ë•Œ, ìƒíƒœë¥¼ ì–´ë–»ê²Œ ë³€í™”ì‹œí‚¤ëŠ”ì§€ ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

```react
export default handleActions(
  {
    [TEMP_SET_USER]: (state, { payload: user }) => ({ ...state, user }),
    [CHECK_SUCCESS]: (state, { payload: user }) => ({ ...state, checkError: null, user }),
    [CHECK_FAILURE]: (state, { payload: error }) => ({ ...state, user: null, checkError: error }),
  },
  initialState,
);
```

ì„±ê³µ í–ˆì„ ë•ŒëŠ” payload ì— ë‹´ê¸´ user ì •ë³´ë¥¼ ìƒíƒœì˜ user ì— ë‹´ê³ , userError ê°’ì„ null ë¡œ ë³€ê²½í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ì‹¤íŒ¨í–ˆì„ ë•ŒëŠ” checkError ì— ê°’ì„ ë„£ê³ , user ì— null ì„ ë„£ì–´ ë¡œê·¸ì¸ ë˜ì§€ ì•Šì•˜ìŒì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.



#### ë¡œê·¸ì•„ì›ƒ

ë¡œê·¸ì•„ì›ƒì€ ë¡œê·¸ì¸ ì—¬ë¶€ í™•ì¸ ì‹¤íŒ¨ì™€ ë¹„ìŠ·í•œ ì²˜ë¦¬ë¥¼ í•©ë‹ˆë‹¤. ë‹¤ë¥¸ ì ì´ë¼ë©´ ì„œë²„ì—ê²Œ logout í–ˆë‹¤ëŠ” ë©”ì‹œì§€ë¥¼ ì „ì†¡í•˜ëŠ” ì²˜ë¦¬ë¥¼ ì¶”ê°€í•´ì£¼ì–´ì•¼ í•˜ëŠ” ë¶€ë¶„ì…ë‹ˆë‹¤.

ë¡œê·¸ì•„ì›ƒ ì•¡ì…˜ì˜ ê²½ìš° íƒ€ì…ë§Œ ìˆìœ¼ë©´ ë˜ê¸° ë•Œë¬¸ì— ì„¤ëª…ì€ ìƒëµí•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

```react
const LOGOUT = 'user/LOGOUT';
export const logout = createAction(LOGOUT);
```



ì´ì œ ì„œë²„ë¡œ ë¡œê·¸ì•„ì›ƒ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•˜ê³ , localStorage ì—ì„œ user ì •ë³´ë¥¼ ì œê±°í•˜ëŠ” í•¨ìˆ˜ë¥¼ ìƒì„±í•˜ëŠ”ë°, ì„œë²„ë¡œ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•˜ëŠ” ë¶€ë¶„ì´ ë¹„ë™ê¸°ì´ë¯€ë¡œ, ë¦¬ë•ìŠ¤ ì‚¬ê°€ ì œë„ˆë ˆì´í„° í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤.

```react
function* logoutSaga() {
  try {
      yield call(authAPI.logout);
      localStorage.removeItem('user');
  } catch (e) {
      console.log('localStorage is not working');
  }
}

export function* userSaga() {
  yield takeLatest(CHECK, checkSaga);
  yield takeLatest(CHECK_FAILURE, checkFailureSaga);
  yield takeLatest(LOGOUT, logoutSaga);
}
```

ë¡œê·¸ì•„ì›ƒ ìš”ì²­ì„ ë³´ëƒˆì„ ë•Œ, ì„œë²„ì—ì„œ ë‚´ìš©ì„ ì „ì†¡í•˜ì§€ëŠ” ì•Šê¸° ë•Œë¬¸ì—, ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì„œë²„ì—ì„œ ë³´ë‚´ëŠ” ë©”ì‹œì§€ì— ìƒê´€ ì—†ì´ ë¡œê·¸ì•„ì›ƒ ì ˆì°¨ê°€ ì§„í–‰ë©ë‹ˆë‹¤.



ì´ì œ ë¦¬ë“€ì„œì—ì„œ ë¡œê·¸ì•„ì›ƒ ì•¡ì…˜ì´ ë””ìŠ¤íŒ¨ì¹˜ ë˜ì—ˆì„ ë•Œ, user ì— null ì„ ë„£ì–´ì£¼ëŠ” ì‘ì—…ë§Œ í•˜ë©´ ë¡œê·¸ì•„ì›ƒ ë° ë¡œê·¸ì¸ ì²´í¬ ìƒíƒœë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.

```react
export default handleActions(
  {
    [TEMP_SET_USER]: (state, { payload: user }) => ({ ...state, user }),
    [CHECK_SUCCESS]: (state, { payload: user }) => ({ ...state, checkError: null, user }),
    [CHECK_FAILURE]: (state, { payload: error }) => ({ ...state, user: null, checkError: error }),
    [LOGOUT]: (state) => ({ ...state, user: null }),
  },
  initialState,
);
```



#### ì „ì²´ ì½”ë“œ

```react
import { createAction, handleActions } from 'redux-actions';
import { takeLatest, call } from 'redux-saga/effects';
import * as authAPI from '../lib/api/auth';
import createRequestSaga, { createRequestActionTypes } from '../lib/createRequestSaga';

const TEMP_SET_USER = 'user/TEMP_SET_USER';
const [CHECK, CHECK_SUCCESS, CHECK_FAILURE] = createRequestActionTypes('/user/CHECK');

const LOGOUT = 'user/LOGOUT';

export const tempSetUser = createAction(TEMP_SET_USER, (user) => user);
export const check = createAction(CHECK);
export const logout = createAction(LOGOUT);

const checkSaga = createRequestSaga(CHECK, authAPI.check);

function checkFailureSaga() {
  try {
    localStorage.removeItem('user');
  } catch (e) {
    console.log('localStorage is not working');
  }
}

function* logoutSaga() {
  try {
    yield call(authAPI.logout);
    localStorage.removeItem('user');
  } catch (e) {
    console.log('localStorage is not working');
  }
}

export function* userSaga() {
  yield takeLatest(CHECK, checkSaga);
  yield takeLatest(CHECK_FAILURE, checkFailureSaga);
  yield takeLatest(LOGOUT, logoutSaga);
}

const initialState = {
  user: null,
  checkError: null,
};

export default handleActions(
  {
    [TEMP_SET_USER]: (state, { payload: user }) => ({ ...state, user }),
    [CHECK_SUCCESS]: (state, { payload: user }) => ({ ...state, checkError: null, user }),
    [CHECK_FAILURE]: (state, { payload: error }) => ({ ...state, user: null, checkError: error }),
    [LOGOUT]: (state) => ({ ...state, user: null }),
  },
  initialState,
);
```



## ì»´í¬ë„ŒíŠ¸

ì»´í¬ë„ŒíŠ¸ ì„¹ì…˜ì€ ìƒíƒœë¥¼ ê°€ì§€ê³  ìˆì§€ ì•Šì€, í”„ë ˆì  í…Œì´ì…˜ ì»´í¬ë„ŒíŠ¸ì— ëŒ€í•´ ë‹¤ë£¹ë‹ˆë‹¤. `AuthTemplate` ì»´í¬ë„ŒíŠ¸ì™€ `AuthForm` ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.



### AuthTemplate

`AuthTemplete` ì»´í¬ë„ŒíŠ¸ì˜ ìœ„ì¹˜ëŠ” `components/auth/AuthTemplate.js` ì…ë‹ˆë‹¤. í•´ë‹¹ íŒŒì¼ ë‚´ì—ì„œ styled-components ë¥¼ ì‚¬ìš©í•´ ë§Œë“  ì»´í¬ë„ŒíŠ¸ëŠ” 2ê°œ ì…ë‹ˆë‹¤.

#### AuthTemplateBlock

```react
const AuthTemplateBlock = styled.div`
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  right: 0;
  background: ${palette.gray[2]};
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
`;
```

í™”ë©´ ì „ì²´ë¥¼ ì°¨ì§€í•˜ê³ , flex ë°•ìŠ¤ë¡œ ë‚´ë¶€ í•­ëª©ì„ ê°€ìš´ë° ì •ë ¬í•©ë‹ˆë‹¤.



#### WhiteBox

```react
const WhiteBox = styled.div`
  .logo-area {
    display: block;
    padding-bottom: 2rem;
    text-align: center;
    font-weight: bold;
    letter-spacing: 2px;
  }
  box-shadow: 0 0 8px rgba(0, 0, 0, 0.025);
  padding: 2rem;
  width: 360px;
  background: white;
  border-radius: 2px;
`;
```

WhiteBox ì»´í¬ë„ŒíŠ¸ ë‚´ì— í´ë˜ìŠ¤ ì´ë¦„ì´ `logo-area` ì¸ ë°•ìŠ¤ê°€ ë“¤ì–´ê°€ê³ , ë¡œê³ ë¥¼ ë„£ì„ ì˜ˆì •ì…ë‹ˆë‹¤. WhtieBox ì»´í¬ë„ŒíŠ¸ëŠ” ê·¸ë¦¼ì íš¨ê³¼ê°€ ìˆê³ , ë°°ê²½ì€ í° ìƒ‰ì´ê³ , í…Œë‘ë¦¬ëŠ” ì•½ê°„ ë‘¥ê¸€ê²Œ ì²˜ë¦¬í–ˆìŠµë‹ˆë‹¤.



#### AuthTemplate

ì´ íŒŒì¼ì˜ ì£¼ì¸ê³µì…ë‹ˆë‹¤.

```react
function AuthTemplate({ children }) {
  return (
    <AuthTemplateBlock>
      <WhiteBox>
        <div className="logo-area">
          <Link to="/">REACTERS</Link>
        </div>
        {children}
      </WhiteBox>
    </AuthTemplateBlock>
  );
}
```

AuthTemplateBox ë‚´ì— WhiteBox ë¥¼ ê°€ìš´ë°ì— ìœ„ì¹˜ì‹œí‚¤ê³ , REACTERS ë¼ëŠ” ë¡œê³ ëŠ” í´ë¦­í•˜ë©´ í™ˆìœ¼ë¡œ ì´ë™í•˜ë„ë¡ ì²˜ë¦¬í–ˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ë¶€ëª¨ë¡œ ë¶€í„° ë°›ì€ children ì„ WhiteBox ë‚´ë¶€ì— ë„£ìŠµë‹ˆë‹¤.



### AuthForm

AuthForm ì»´í¬ë„ŒíŠ¸ëŠ” ë¡œê·¸ì¸ê³¼ íšŒì›ê°€ì… ì‹œ ì‚¬ìš©ìì˜ ì…ë ¥ì„ ë°›ëŠ” ë¶€ë¶„ì„ í™”ë©´ì— ë‚˜íƒ€ë‚´ëŠ” ë¶€ë¶„ì…ë‹ˆë‹¤. ì´ë²ˆì—ë„ styled-components ë¡œ ë§Œë“  ì»´í¬ë„ŒíŠ¸ë“¤ì„ ë¨¼ì € ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.



#### ErrorMessage

```react
const ErrorMessage = styled.div`
  color: red;
  text-align: center;
  font-size: 0.875rem;
  margin-top: 1rem;
`;
```

ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ë‚˜íƒ€ë‚¼ ì»´í¬ë„ŒíŠ¸ì…ë‹ˆë‹¤. ê¸€ì ìƒ‰ì€ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ì²˜ë¦¬í–ˆìŠµë‹ˆë‹¤.



#### AuthFormBlock

```react
const AuthFormBlock = styled.div`
  h3 {
    margin: 0;
    color: ${palette.gray[8]};
    margin-bottom: 1rem;
  }
`;
```

AuthFormBlock ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì—ëŠ” `h3` íƒœê·¸ê°€ ìˆë‹¤ëŠ” ê²ƒì„ ì•”ì‹œí•©ë‹ˆë‹¤. ëª¨ë“  ê²ƒì´ AuthTemplate ë‚´ì˜ WhiteBox ì— ë“¤ì–´ê°ˆ ì˜ˆì •ì´ë¯€ë¡œ, ë³„ë„ì˜ ìŠ¤íƒ€ì¼ ì†ì„±ì„ ì£¼ì§€ëŠ” ì•Šì•˜ìŠµë‹ˆë‹¤.



#### StyledInput

```react
const StyledInput = styled.input`
  font-size: 1rem;
  border: none;
  border-bottom: 1px solid ${palette.gray[5]};
  padding-bottom: 0.5rem;
  outline: none;
  width: 100%;
  &:focus {
    color: $oc-teal-7;
    border-bottom: 1px solid ${palette.gray[7]};
  }
  & + & {
    margin-top: 1rem;
  }
`;
```

`input` íƒœê·¸ì— ìŠ¤íƒ€ì¼ì„ ì£¼ì—ˆìŠµë‹ˆë‹¤. í…Œë‘ë¦¬ëŠ” í•˜ë‹¨ì—ë§Œ ì£¼ì—ˆìŠµë‹ˆë‹¤. ë˜í•œ í¬ì»¤ìŠ¤ ë˜ì—ˆì„ ë•Œ ê¸€ììƒ‰ê³¼ í•˜ë‹¨ ì„ ì˜ ìƒ‰ìƒì´ ë³€ê²½ë˜ë„ë¡ í–ˆê³ , ì—¬ëŸ¬ê°œì˜ StyledInput íƒœê·¸ê°€ ì—°ì†ìœ¼ë¡œ ë‚˜ì˜¤ë©´, ì²˜ìŒ ë‚˜ì˜¨ StyledInput ì»´í¬ë„ŒíŠ¸ë¥¼ ì œì™¸í•˜ê³  `margin-top` ì„ ì¤¬ìŠµë‹ˆë‹¤.



#### Footer

```react
const Footer = styled.div`
  margin-top: 2rem;
  text-align: right;
  a {
    color: ${palette.gray[6]};
    text-decoration: underline;
    &:hover {
      color: ${palette.gray[9]};
    }
  }
`;
```

Footer ì»´í¬ë„ŒíŠ¸ëŠ” ë¡œê·¸ì¸ í˜ì´ì§€ì˜ í•˜ë‹¨ì— ìœ„ì¹˜í•˜ê²Œë  ì»´í¬ë„ŒíŠ¸ì…ë‹ˆë‹¤. ì˜¤ë¥¸ìª½ ì •ë ¬ì„ í–ˆê³ , ë¡œê·¸ì¸ í˜ì´ì§€ì¼ ê²½ìš° íšŒì›ê°€ì…ìœ¼ë¡œ, íšŒì›ê°€ì… í˜ì´ì§€ì¼ ê²½ìš° ë¡œê·¸ì¸ìœ¼ë¡œ ì´ë™í•˜ëŠ” ë§í¬ê°€ ìœ„ì¹˜í•  ì˜ˆì •ì…ë‹ˆë‹¤.



#### ButtonWithMarginTop

```react
const ButtonWithMarginTop = styled(Button)`
  margin-top: 1rem;
`;
```

ê¸°ì¡´ì— Button ì»´í¬ë„ŒíŠ¸ë¥¼ ë§Œë“¤ì—ˆëŠ”ë°, ì´ ì»´í¬ë„ŒíŠ¸ëŠ” ë”°ë¡œ ì„¤ëª…í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. Button ì»´í¬ë„ŒíŠ¸ì— `margin-top` ì†ì„±ì„ ì£¼ì—ˆìŠµë‹ˆë‹¤.



#### AuthForm

ì£¼ì¸ê³µì´ ê°€ì¥ ë§ˆì§€ë§‰ì— ë“±ì¥í–ˆìŠµë‹ˆë‹¤.

```react
const textMap = {
  login: 'ë¡œê·¸ì¸',
  register: 'íšŒì›ê°€ì…',
};

function AuthForm({ type, form, onChange, onSubmit, error }) {
  const text = textMap[type];
  return (
    <AuthFormBlock>
      <h3>{text}</h3>
      <form onSubmit={onSubmit}>
        <StyledInput
          autoComplete="username"
          name="username"
          placeholder="ì•„ì´ë””"
          onChange={onChange}
          value={form.username || ''}
        />
        <StyledInput
          autoComplete="new-password"
          name="password"
          placeholder="ë¹„ë°€ë²ˆí˜¸"
          type="password"
          onChange={onChange}
          value={form.password || ''}
        />
        {type === 'register' && (
          <StyledInput
            autoComplete="new-password"
            name="passwordConfirm"
            placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸"
            type="password"
            onChange={onChange}
            value={form.passwordConfirm || ''}
          />
        )}
        {error && <ErrorMessage>{error}</ErrorMessage>}
        <ButtonWithMarginTop fullWidth cyan type="submit">
          {textMap[type]}
        </ButtonWithMarginTop>
      </form>
      <Footer>{type === 'login' ? <Link to="/register">íšŒì›ê°€ì…</Link> : <Link to="/login">ë¡œê·¸ì¸</Link>}</Footer>
    </AuthFormBlock>
  );
}
```

`textMap` ì€ type ì— ë”°ë¼ ì–´ë–¤ ê¸€ì„ ë³´ì—¬ì¤„ì§€ ê²°ì •í•˜ë„ë¡ í•˜ëŠ” ê°ì²´ì…ë‹ˆë‹¤. ë¶€ëª¨ì—ê²Œ `type`, `form`, `onChange`, `onSubmit`, `error` props ë¥¼ ë°›ê²Œ ë©ë‹ˆë‹¤. 

* type: login ë˜ëŠ” register
* form: ë¦¬ë•ìŠ¤ ì „ì—­ ìƒíƒœì˜ state.auth.login ë˜ëŠ” state.auth.register
* onChnage: `input` íƒœê·¸ì˜ ìƒíƒœë¥¼ ì²˜ë¦¬í•˜ëŠ” ì´ë²¤íŠ¸ ë©”ì„œë“œ
* onSubmit: í¼ì„ ì œì¶œí–ˆì„ ë•Œ ìƒíƒœë¥¼ ì²˜ë¦¬í•˜ëŠ” ì´ë²¤íŠ¸ ë©”ì„œë“œ
* error: ì—ëŸ¬ ë©”ì‹œì§€(ErrorMessage ì»´í¬ë„ŒíŠ¸)ì— ë³´ì—¬ì¤„ ë‚´ìš©

`type` ìœ¼ë¡œ ì œëª©ì— ì–´ë–¤ ë¬¸ìì—´ì„ ë³´ì—¬ì¤„ì§€ ê²°ì •í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  `type` ì´ register ì¼ ê²½ìš°, ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì…ë ¥ì„ ë°›ëŠ” StyledInput ì»´í¬ë„ŒíŠ¸ë¥¼ ì¶”ê°€ë¡œ ë³´ì—¬ì¤ë‹ˆë‹¤. ë§Œì•½ `error` ê°’ì´ ì¡´ì¬í•˜ë©´, ErrorMessage ì»´í¬ë„ŒíŠ¸ë¥¼ ë³´ì—¬ì£¼ê³ , ë¡œê·¸ì¸ ë˜ëŠ” íšŒì›ê°€ì… ë²„íŠ¼ì„ ë³´ì—¬ì¤ë‹ˆë‹¤. ë§ˆì§€ë§‰ìœ¼ë¡œ Footer ì»´í¬ë„ŒíŠ¸ëŠ” í˜„ì¬ `type` ì´ login ì¼ ê²½ìš° íšŒì›ê°€ì… ë§í¬ë¥¼, register ì¼ ê²½ìš° ë¡œê·¸ì¸ ë§í¬ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.



## ì»¨í…Œì´ë„ˆ

ì»¨í…Œì´ë„ˆëŠ” ìœ„ì— ë§Œë“  í”„ë ˆì  í…Œì´ì…˜ ì»´í¬ë„ŒíŠ¸ì— ìƒíƒœë¥¼ ì£¼ì…í•©ë‹ˆë‹¤. ë¨¼ì € LoginForm ì»¨í…Œì´ë„ˆ ì»´í¬ë„ŒíŠ¸ ë¨¼ì € ì‚´í´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.



### LoginForm

```react
import { useEffect, useState } from 'react';
import { useSelector, useDispatch } from 'react-redux';
import { withRouter } from 'react-router-dom';
import { changeField, initializeForm, login } from '../../modules/auth';
import AuthForm from '../../components/auth/AuthForm';
import { check } from '../../modules/user';
```

ì¼ë‹¨ useEffect ë¥¼ ì‚¬ìš©í•´ì„œ ì‚¬ìš©ìê°€ LoginForm ì»´í¬ë„ŒíŠ¸ê°€ ë Œë”ë§ ë˜ì—ˆì„ ë•Œ, ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ì— ì„±ê³µí–ˆëŠ”ì§€ ì‹¤íŒ¨í–ˆëŠ”ì§€ ì²˜ë¦¬í•  ê²ƒì…ë‹ˆë‹¤. useStateëŠ” ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ë³´ì—¬ì£¼ëŠ” ë¶€ë¶„ì„ ì²˜ë¦¬í•  ê²ƒì…ë‹ˆë‹¤.

useSelector ì™€ useDispatch í›…ì„ ì‚¬ìš©í•´ì„œ ì „ì—­ ìƒíƒœë¥¼ ê°€ì ¸ì˜¤ê³ , ë””ìŠ¤íŒ¨ì¹˜í•  ê²ƒì…ë‹ˆë‹¤.

withRouter ëŠ” ë¡œê·¸ì¸ì— ì„±ê³µí–ˆì„ ë•Œ, history.push ë¥¼ ì‚¬ìš©í•´ í™ˆ í˜ì´ì§€ë¡œ ì´ë™ì‹œí‚¤ê¸° ìœ„í•´ ì‚¬ìš©í•  HOC ì…ë‹ˆë‹¤.

changeField ì™€ initializeForm, login ì€ ì•¡ì…˜ ìƒì„± í•¨ìˆ˜ì…ë‹ˆë‹¤. ì´ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ ì•¡ì…˜ì„ ë§Œë“¤ê³  ë””ìŠ¤íŒ¨ì¹˜í•´ ì „ì—­ ìƒíƒœë¥¼ ë³€ê²½í•  ì˜ˆì •ì…ë‹ˆë‹¤.

AuthForm ì»´í¬ë„ŒíŠ¸ëŠ” LoginForm ì»¨í…Œì´ë„ˆ ì»´í¬ë„ŒíŠ¸ê°€ ìƒíƒœë¥¼ ì£¼ì…í•  ì»´í¬ë„ŒíŠ¸ì…ë‹ˆë‹¤.

check ëŠ” ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ ì²´í¬í•˜ëŠ” ì•¡ì…˜ ìƒì„± í•¨ìˆ˜ì…ë‹ˆë‹¤.



LoginForm ì»´í¬ë„ŒíŠ¸ì˜ ì—­í• ì€ AuthForm ì»´í¬ë„ŒíŠ¸ì— ìƒíƒœë¥¼ ì£¼ì…í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì¼ë‹¨ AuthForm ì»´í¬ë„ŒíŠ¸ì—ì„œ ì–´ë–¤ ê°’ë“¤ì„ propsë¡œ ë°›ëŠ”ì§€ ì‚´í´ë³´ì•„ì•¼ í•©ë‹ˆë‹¤.

```react
function AuthForm({ type, form, onChange, onSubmit, error }){
    // ...
}
```

type, form, onChange, onSubmit, error ì´ 5 ê°œì˜ propsë¥¼ ë„£ì–´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤. type ì€ login ì…ë‹ˆë‹¤. 

form ì€ ì „ì—­ ìƒíƒœë¥¼ ê°€ì ¸ì™€ì„œ ë„£ì–´ ì£¼ì–´ì•¼í•©ë‹ˆë‹¤. ì§€ê¸ˆê¹Œì§€ ìš°ë¦¬ê°€ ë§Œë“¤ì—ˆë˜ auth ë¦¬ë“€ì„œì™€ user ë¦¬ë“€ì„œ, loading ë¦¬ë“€ì„œì˜ ì „ì—­ ìƒíƒœëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```javascript
const state = {
  auth: {
      register: {
          // ...
      }
      login: {
          username: '',
          password: ''
      },
	  auth: null,
      authError: null
  },
  user: {
      user: null,
      checkError: null
  },
  loading: {},
}
```

ì—¬ê¸°ì„œ form ì— ë„£ì–´ì£¼ì–´ì•¼ í•˜ëŠ” ìƒíƒœëŠ” state.auth.login ì…ë‹ˆë‹¤. ì´ ê°’ì„ useSelector ë¥¼ ì‚¬ìš©í•´ ë‹¤ìŒê³¼ ê°™ì´ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```react
const {form} = useSelector(({auth}) => ({form: auth.login}));
```



onChange ëŠ” AuthForm ì»´í¬ë„ŒíŠ¸ì˜ ì…ë ¥ì„ ì²˜ë¦¬í•˜ëŠ” ë¶€ë¶„ìœ¼ë¡œ, changeField ì•¡ì…˜ ìƒì„± í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ ë””ìŠ¤íŒ¨ì¹˜ í•  ê²ƒì…ë‹ˆë‹¤.

```react
const onChange = (event) => {
  const { name, value } = event.target;
  dispatch(changeField({ form: 'login', key: name, value }));
};
```



onSubmit ì€ ì „ì—­ ìƒíƒœì˜ state.auth.login ê°’ì„ login ì•¡ì…˜ ìƒì„± í•¨ìˆ˜ì˜ ë§¤ê°œë³€ìˆ˜ë¡œ ë„£ì–´ì£¼ê³ , ì´ë¥¼ ë””ìŠ¤íŒ¨ì¹˜ í•˜ëŠ” ì—­í• ì„ í•´ì•¼ í•©ë‹ˆë‹¤. state.auth.login ì€ ìœ„ì˜ useSelector ë¥¼ ì‚¬ìš©í•´ form ì— ë‹´ì•˜ìœ¼ë¯€ë¡œ ì´ë¥¼ ì‚¬ìš©í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

```react
const onSubmit = (event) => {
  event.preventDefault();
  const { username, password } = form;
  dispatch(login({ username, password }));
};
```



error ëŠ” ì„œë²„ì™€ì˜ í†µì‹  ì´í›„ ê°’ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë§í•˜ìë©´, onSubmit ì´í›„ì— ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆì„ ë•Œ, error ê°€ ìƒê¹ë‹ˆë‹¤. ë”°ë¼ì„œ í˜„ì¬ ì»´í¬ë„ŒíŠ¸ì—ì„œ useState ë¥¼ ì‚¬ìš©í•´ error ìƒíƒœë¥¼ ë§Œë“¤ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

```react
const [error, setError] = useState(null);
```



ì´ì œ ì „ì²´ ì½”ë“œë¥¼ ì‚´í´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

```react
function LoginForm({ history }) {
  const [error, setError] = useState(null);
  const dispatch = useDispatch();
  const { form, auth, authError, user } = useSelector(({ auth, user }) => ({
    form: auth.login,
    auth: auth.auth,
    authError: auth.authError,
    user: user.user,
  }));

  const onChange = (event) => {
    const { name, value } = event.target;
    dispatch(changeField({ form: 'login', key: name, value }));
  };

  const onSubmit = (event) => {
    event.preventDefault();
    const { username, password } = form;
    dispatch(login({ username, password }));
  };

  useEffect(() => {
    dispatch(initializeForm('login'));
  }, [dispatch]);

  useEffect(() => {
    if (authError) {
      setError('ë¡œê·¸ì¸ ì‹¤íŒ¨');
    }

    if (auth) {
      console.log('ë¡œê·¸ì¸ ì„±ê³µ');
      dispatch(check());
    }
  }, [authError, auth, dispatch]);

  useEffect(() => {
    if (user) {
      history.push('/');
      try {
        localStorage.setItem('user', JSON.stringify(user));
      } catch (e) {
        console.log('localStorage is not working');
      }
    }
  }, [history, user]);

  return <AuthForm type="login" form={form} onChange={onChange} onSubmit={onSubmit} error={error} />;
}
```

ì´ë²ˆì—ëŠ” useEffect ë¶€ë¶„ì„ ì¤‘ì ìœ¼ë¡œ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤. ì²˜ìŒ ë“±ì¥í•˜ëŠ” useEffectì—ì„œëŠ” login í¼ì„ ì´ˆê¸°í™”í•©ë‹ˆë‹¤. ì‹¤ì§ˆì ìœ¼ë¡œ state.auth.login ì˜ ìƒíƒœ ê°’ì„ ì´ˆê¸° ìƒíƒœë¡œ ë˜ëŒë¦¬ëŠ” ì‘ì—…ì„ í•©ë‹ˆë‹¤.

ë‘ ë²ˆì§¸ useEffect ëŠ” ë§Œì•½ ì „ì—­ ìƒíƒœì˜ state.auth.authError ê°€ ìˆìœ¼ë©´ error ìƒíƒœë¥¼ 'ë¡œê·¸ì¸ ì‹¤íŒ¨' ë¡œ ì„¤ì •í•˜ê³ , state.auth.auth ê°€ ì¡´ì¬í•˜ë©´ ì½˜ì†”ì— 'ë¡œê·¸ì¸ ì„±ê³µ' ì„ ì¶œë ¥í•˜ê³ , ë¡œê·¸ì¸ì„ ì¸ì¦í•˜ëŠ” ê³¼ì •ì„ ê±°ì¹©ë‹ˆë‹¤.

ì„¸ ë²ˆì§¸ useEffect ëŠ” state.user.user ê°€ ì¡´ì¬í•  ê²½ìš°, ë¡œê·¸ì¸ì— ì„±ê³µí•œ ìƒíƒœì´ë¯€ë¡œ, í™ˆ í™”ë©´ìœ¼ë¡œ ì´ë™í•˜ë„ë¡ í•˜ê³ , localStorage ì— user ì˜ ì •ë³´ë¥¼ ë‹´ìŠµë‹ˆë‹¤.



> **ë¡œê·¸ì¸ ì„±ê³µ ì‹œë‚˜ë¦¬ì˜¤**
>
> dispatch(initializeForm('login')) -> username onChange -> password onChange -> onSubmit -> dispatch(login({username, password})) -> dispatch(check()) -> history.push('/') -> localStorage.setItem



> **ë¡œê·¸ì¸ ì‹¤íŒ¨ ì‹œë‚˜ë¦¬ì˜¤**
>
> dispatch(initializeForm('login')) -> username onChange -> password onChange -> onSubmit -> dispatch(login({username, password})) -> setError('ë¡œê·¸ì¸ ì‹¤íŒ¨')



### RegisterForm

RegisterForm ì—­ì‹œ AuthForm ì»´í¬ë„ŒíŠ¸ì— ìƒíƒœë¥¼ ì£¼ì…í•©ë‹ˆë‹¤. LoginForm ê³¼ ê±°ì˜ ë˜‘ê°™ê³ , í¼ì˜ ìœ íš¨ì„±ì„ ê²€ì¦í•˜ëŠ” ë¶€ë¶„ë§Œ ë‹¤ë¥´ë¯€ë¡œ, ì„¤ëª…ì€ ìƒëµí•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

```react
import { useEffect, useState } from 'react';
import { useSelector, useDispatch } from 'react-redux';
import { withRouter } from 'react-router-dom';
import { changeField, initializeForm, register } from '../../modules/auth';
import AuthForm from '../../components/auth/AuthForm';
import { check } from '../../modules/user';

function RegisterForm({ history }) {
  const [error, setError] = useState(null);
  const dispatch = useDispatch();
  const { form, auth, authError, user } = useSelector(({ auth, user }) => ({
    form: auth.register,
    auth: auth.auth,
    authError: auth.authError,
    user: user.user,
  }));

  const onChange = (event) => {
    const { name, value } = event.target;
    dispatch(changeField({ form: 'register', key: name, value }));
  };

  const onSubmit = (event) => {
    event.preventDefault();

    const { username, password, passwordConfirm } = form;

    if ([username, password, passwordConfirm].includes('')) {
      setError('ë¹ˆ ì¹¸ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.');
      return;
    }

    if (password !== passwordConfirm) {
      setError('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
      return;
    }
    dispatch(register({ username, password }));
  };

  useEffect(() => {
    dispatch(initializeForm('register'));
  }, [dispatch]);

  useEffect(() => {
    if (authError) {
      if (authError.response.status === 409) {
        setError('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ê³„ì •ëª…ì…ë‹ˆë‹¤.');
        return;
      }

      setError('íšŒì›ê°€ì… ì‹¤íŒ¨');
      return;
    }

    if (auth) {
      console.log('íšŒì›ê°€ì… ì„±ê³µ');
      console.log(auth);
      dispatch(check());
    }
  }, [authError, auth, dispatch]);

  useEffect(() => {
    if (user) {
      history.push('/');
      try {
        localStorage.setItem('user', JSON.stringify(user));
      } catch (e) {
        console.log('localStorage is not working');
      }
    }
  }, [user, history]);

  return <AuthForm type="register" form={form} onChange={onChange} onSubmit={onSubmit} error={error} />;
}

export default withRouter(RegisterForm);
```



## í˜ì´ì§€

ë§ˆì§€ë§‰ìœ¼ë¡œ, ì‹¤ì œ í™”ë©´ì— ë³´ì—¬ì¤„ í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸ì…ë‹ˆë‹¤. ê¸°ì¡´ì— ë§Œë“  ì»¨í…Œì´ë„ˆ ì»´í¬ë„ŒíŠ¸ì™€ í”„ë ˆì  í…Œì´ì…˜ ì»´í¬ë„ŒíŠ¸ë¥¼ ì˜ ì¡°í•©í•´ì„œ í™”ë©´ì— ë¡œê·¸ì¸ê³¼ íšŒì›ê°€ì… í˜ì´ì§€ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.

### LoginPage

```react
import AuthTemplate from '../components/auth/AuthTemplate';
import LoginForm from '../containers/auth/LoginForm';

function LoginPage() {
  return (
    <AuthTemplate>
      <LoginForm />
    </AuthTemplate>
  );
}

export default LoginPage;
```

ì •ë§ ê°„ë‹¨í•©ë‹ˆë‹¤. AuthTemplate ì»´í¬ë„ŒíŠ¸ ë‚´ì— LoginForm ì»´í¬ë„ŒíŠ¸ë¥¼ ë„£ì–´ í™”ë©´ì— ë³´ì—¬ì¤ë‹ˆë‹¤.



### RegisterPage

```react
import AuthTemplate from '../components/auth/AuthTemplate';
import RegisterForm from '../containers/auth/RegisterForm';

function RegisterPage() {
  return (
    <AuthTemplate>
      <RegisterForm />
    </AuthTemplate>
  );
}

export default RegisterPage;
```

RegisterPage ì—­ì‹œ AuthTemplate ì»´í¬ë„ŒíŠ¸ ë‚´ì— RegisterForm ì»´í¬ë„ŒíŠ¸ë¥¼ ë„£ì–´ í™”ë©´ì— ë³´ì—¬ì¤ë‹ˆë‹¤.



## ìƒˆë¡œê³ ì¹¨ ì‹œ ë¡œê·¸ì¸ ì—¬ë¶€ í™•ì¸

ìƒˆë¡œê³ ì¹¨ í–ˆì„ ë•Œ, ë¦¬ì•¡íŠ¸ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì „ì²´ë¥¼ ë‹¤ì‹œ ë Œë”ë§í•˜ê³ , ë¦¬ë•ìŠ¤ë„ ì´ˆê¸°í™”ë©ë‹ˆë‹¤. ë”°ë¼ì„œ, ìš°ë¦¬ê°€ ë¡œê·¸ì¸ í–ˆëŠ”ì§€ ì—¬ë¶€ë¥¼ localStorage ì— ì €ì¥í•´ ë‘” ê°’ì„ ê°€ì ¸ì™€ì„œ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.

ê·¸ëŸ¼ ìƒˆë¡œê³ ì¹¨ ì²˜ë¦¬ ë¶€ë¶„ì„ ì–´ë””ì— ë„£ëŠ” ê²ƒì´ ê°€ì¥ ì¢‹ì„ê¹Œìš”? ì´ë²ˆ í”„ë¡œì íŠ¸ì—ì„œëŠ” `src/index.js` ì— ë„£ì—ˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì—  ë„£ì–´ ì¤€ ì´ìœ ëŠ” index ê°€ ê°€ì¥ ë¨¼ì € ë Œë”ë§ ë˜ëŠ” ë¶€ë¶„ì¸ë°, ì—¬ê¸°ì„œ ì²˜ë¦¬í•˜ë©´, ìš°ë¦¬ê°€ ë§Œë“  LoginPage ë˜ëŠ” RegisterPage ì»´í¬ë„ŒíŠ¸ê°€ ë Œë”ë§ ë˜ê¸° ì „ì— ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ í™•ì¸í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ë¡œê·¸ì¸ ìœ ì €ê°€ ë¡œê·¸ì¸ í˜ì´ì§€ì— ë‹¤ì‹œ ì ‘ê·¼í–ˆì„ ë•Œ, ë¡œê·¸ì¸ í˜ì´ì§€ê°€ ì ê¹ë™ì•ˆ ë³´ì´ëŠ” ê²ƒì„ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```react
// src/index.js
const saga = createSagaMiddleware();

const store = createStore(rootReducer, composeWithDevTools(applyMiddleware(saga)));
saga.run(rootSaga);
loadUser();

function loadUser() {
  try {
    const user = localStorage.getItem('user');
    if (!user) {
      return;
    }

    store.dispatch(tempSetUser(JSON.parse(user)));
    store.dispatch(check());
  } catch (e) {
    console.log('localStorage is not working');
  }
}
```

loadUser í•¨ìˆ˜ê°€ localStorage ì— ì‚¬ìš©ì ì •ë³´ê°€ ìˆëŠ”ì§€ í™•ì¸í•˜ê³ , ì´ë¥¼ ì‚¬ìš©í•´ ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ ì²´í¬í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤. ì£¼ì˜í•´ì•¼ í•  ì ì€ ê¼­ `saga.run(rootSaga)` ë’¤ì— ì™€ì•¼í•˜ëŠ” ì ì…ë‹ˆë‹¤. check ì•¡ì…˜ í•¨ìˆ˜ë¡œ ìƒì„±í•œ ì•¡ì…˜ì„ ë””ìŠ¤íŒ¨ì¹˜í•˜ëŠ” ë¶€ë¶„ì„ ë¦¬ë•ìŠ¤ ì‚¬ê°€ë¡œ êµ¬í˜„í–ˆê¸° ë•Œë¬¸ì—, ì‚¬ê°€ê°€ ì‹¤í–‰ ëœ í›„ loadUser í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ì•¼ ì‚¬ê°€ í•¨ìˆ˜ê°€ ì œëŒ€ë¡œ ë™ì‘í•©ë‹ˆë‹¤.

